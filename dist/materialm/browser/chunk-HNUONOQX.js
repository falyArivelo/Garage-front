import"./chunk-MZ75U4Y2.js";import{a as ce}from"./chunk-RJXWPBJQ.js";import{a as ue,b as Z}from"./chunk-X7TWZBHP.js";import{a as de}from"./chunk-NE6SGPLR.js";import{a as pe}from"./chunk-46CZSLJQ.js";import{a as vt,b as St}from"./chunk-4CWAV5PF.js";import{$ as I,D as oe,G as re,J as se,L as le,P as N,Q as U,R as W,S as q,T as G,U as z,V as J,W as K,X as Q,Y as X,f as Ct,g as gt,w as D,x as kt}from"./chunk-6GRSV3W3.js";import{a as Y}from"./chunk-3BXQV7YT.js";import{b as rt,e as st,i as lt,j as me,k as xt}from"./chunk-M22CPC4C.js";import{$a as P,Ca as ct,Da as Gt,Ha as zt,Ia as Jt,Ja as Kt,La as Qt,Ma as Xt,Na as Yt,Oa as Zt,Pa as dt,Qa as pt,Ra as ut,Xa as ft,Y as qt,Ya as te,bb as O,cb as _t,eb as ht,gb as ee,hb as ie,jb as ne,lb as M,mb as E,nb as y,pb as Tt,rb as ae,xa as mt,za as H}from"./chunk-LDYTSFDL.js";import{a as Ut,c as Wt}from"./chunk-JHHBZ5S2.js";import{$ as Ht,Bc as Pt,Eb as m,Mb as Bt,Nb as Lt,Ob as a,Pb as o,Qb as C,Rb as d,Sb as p,Ub as et,Uc as Ot,Wb as k,Xb as h,Xc as b,Yc as Nt,Zc as V,bd as j,cd as v,ea as yt,fb as s,gc as S,hc as r,ic as Vt,jc as u,kb as _,kc as Dt,lc as nt,mc as at,nc as ot,oa as A,pa as R,pc as It,qc as B,rc as F,sb as T,tc as x,uc as jt,vc as $,wc as L,xb as c}from"./chunk-NNBNMEEF.js";import{a as Ft,c as $t}from"./chunk-GAL4ENT6.js";var w=(()=>{class t{constructor(e,i){this.http=e,this.authService=i,this.apiUrl=`${me.baseUrl}/tasks`}getAuthHeaders(){let e=localStorage.getItem("carcare-token");if(!e)throw new Error("Token manquant");return new Ut({Authorization:`Bearer ${e}`})}createTask(e){let it=e,{_id:i}=it,l=$t(it,["_id"]),f=Ft({},l),g=this.getAuthHeaders();return this.http.post(this.apiUrl,f,{headers:g})}getAllTasks(){let e=this.getAuthHeaders();return this.http.get(this.apiUrl,{headers:e})}getTaskById(e){let i=this.getAuthHeaders();return this.http.get(`${this.apiUrl}/${e}`,{headers:i})}getTaskByName(e){let i=this.getAuthHeaders();return this.http.get(`${this.apiUrl}/name/${e}`,{headers:i})}updateTask(e){let i=this.getAuthHeaders();return this.http.put(`${this.apiUrl}/${e._id}`,e,{headers:i})}deleteTask(e){let i=this.getAuthHeaders();return this.http.delete(`${this.apiUrl}/${e}`,{headers:i})}assignTask(e,i){let l=this.getAuthHeaders();return this.http.put(`${this.apiUrl}/${e}/assign`,{mechanicId:i},{headers:l})}getTasksForAppointment(e){let i=this.getAuthHeaders();return this.http.get(`${this.apiUrl}/appointments/${e}`,{headers:i})}getTasksByMechanic(e){let i=this.getAuthHeaders();return this.http.get(`${this.apiUrl}/mechanic/${e}`,{headers:i})}markTaskAsDone(e){let i=this.getAuthHeaders();return this.http.put(`${this.apiUrl}/${e}/complete`,{},{headers:i})}updateTaskStatus(e,i,l){let f=this.getAuthHeaders(),g=this.authService.currentUserValue?.user_id;return this.http.put(`${this.apiUrl}/${e}/updateStatus`,{status:i,message:l,userId:g},{headers:f})}static{this.\u0275fac=function(i){return new(i||t)(yt(Wt),yt(xt))}}static{this.\u0275prov=Ht({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var we=t=>[t],Ce=(t,n)=>[t,n],fe=()=>["service","mechanic","date","duration","status","actions"];function Ae(t,n){t&1&&(a(0,"th",20),r(1," Client "),o())}function Re(t,n){if(t&1&&(a(0,"td",21),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.client==null?null:e.client.username," ")}}function Fe(t,n){t&1&&(a(0,"th",20),r(1," V\xE9hicule "),o())}function $e(t,n){if(t&1&&(a(0,"td",21),r(1),o()),t&2){let e=n.$implicit;s(),Dt(" ",e.vehicle==null?null:e.vehicle.brand," ",e.vehicle==null?null:e.vehicle.model," ")}}function He(t,n){t&1&&(a(0,"th",20),r(1," Services "),o())}function Be(t,n){if(t&1&&(a(0,"li"),r(1),o()),t&2){let e=n.$implicit;s(),Vt(e.name)}}function Le(t,n){if(t&1&&(a(0,"ul"),c(1,Be,2,1,"li",23),o()),t&2){let e=h().$implicit;s(),m("ngForOf",e.services)}}function Ve(t,n){t&1&&(a(0,"span"),r(1,"Aucun service"),o())}function je(t,n){if(t&1&&(a(0,"td",21),c(1,Le,2,1,"ul",22)(2,Ve,2,0,"span",22),o()),t&2){let e=n.$implicit;s(),m("ngIf",e.services==null?null:e.services.length),s(),m("ngIf",!(e.services!=null&&e.services.length))}}function Pe(t,n){t&1&&(a(0,"th",20),r(1," Date "),o())}function Oe(t,n){if(t&1&&(a(0,"td",21),r(1),x(2,"date"),o()),t&2){let e=n.$implicit;s(),u(" ",$(2,1,e.appointmentDate,"short")," ")}}function Ne(t,n){t&1&&(a(0,"th",20),r(1," Statut "),o())}function Ue(t,n){if(t&1&&(a(0,"td",21)(1,"span",24),r(2),o()()),t&2){let e=n.$implicit,i=h(2);s(),m("ngClass",F(2,Ce,"bg-light-"+i.getStatusColor(e.status),"text-"+i.getStatusColor(e.status))),s(),u(" ",e.status," ")}}function We(t,n){t&1&&(a(0,"th",20),r(1," Prix estim\xE9 "),o())}function qe(t,n){if(t&1&&(a(0,"td",21),r(1),x(2,"currencyAr"),o()),t&2){let e=n.$implicit;s(),u(" ",jt(2,1,e.totalEstimatedPrice)," ")}}function Ge(t,n){t&1&&C(0,"tr",25)}function ze(t,n){t&1&&C(0,"tr",26)}function Je(t,n){if(t&1&&(a(0,"table",9),d(1,10),c(2,Ae,2,0,"th",11)(3,Re,2,1,"td",12),p(),d(4,13),c(5,Fe,2,0,"th",11)(6,$e,2,2,"td",12),p(),d(7,14),c(8,He,2,0,"th",11)(9,je,3,2,"td",12),p(),d(10,15),c(11,Pe,2,0,"th",11)(12,Oe,3,4,"td",12),p(),d(13,16),c(14,Ne,2,0,"th",11)(15,Ue,3,5,"td",12),p(),d(16,17),c(17,We,2,0,"th",11)(18,qe,3,3,"td",12),p(),c(19,Ge,1,0,"tr",18)(20,ze,1,0,"tr",19),o()),t&2){let e=h();m("dataSource",B(3,we,e.appointment)),s(19),m("matHeaderRowDef",e.displayedColumns),s(),m("matRowDefColumns",e.displayedColumns)}}function Ke(t,n){if(t&1&&(a(0,"mat-option",37),r(1),o()),t&2){let e=n.$implicit;m("value",e._id),s(),Dt(" ",e.name," (",e.estimatedDuration," min) ")}}function Qe(t,n){if(t&1&&(a(0,"mat-option",37),r(1),o()),t&2){let e=n.$implicit;m("value",e._id),s(),u(" ",e.username," ")}}function Xe(t,n){if(t&1){let e=et();a(0,"form",27),k("ngSubmit",function(){A(e);let l=h();return R(l.createTask())}),a(1,"mat-form-field",28)(2,"mat-label"),r(3,"Service"),o(),a(4,"mat-select",29),k("selectionChange",function(l){A(e);let f=h();return R(f.onServiceChange(l.value))}),c(5,Ke,2,3,"mat-option",30),o()(),a(6,"mat-form-field",28)(7,"mat-label"),r(8,"Dur\xE9e (en minutes)"),o(),C(9,"input",31),o(),C(10,"input",32),a(11,"mat-form-field",28)(12,"mat-label"),r(13,"M\xE9canicien"),o(),a(14,"mat-select",33),c(15,Qe,2,2,"mat-option",30),o()(),a(16,"div",34)(17,"button",35),r(18,"Cr\xE9er la t\xE2che"),o(),a(19,"button",36),k("click",function(){A(e);let l=h();return R(l.cancel())}),r(20,"Annuler"),o()()()}if(t&2){let e=h();m("formGroup",e.taskForm),s(5),m("ngForOf",e.services),s(10),m("ngForOf",e.mechanics),s(2),m("disabled",e.taskForm.invalid)}}function Ye(t,n){t&1&&(a(0,"th",20),r(1," Service "),o())}function Ze(t,n){if(t&1&&(a(0,"td",21),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.service==null?null:e.service.name," ")}}function ti(t,n){t&1&&(a(0,"th",20),r(1," M\xE9canicien "),o())}function ei(t,n){if(t&1&&(a(0,"td",21),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.mechanic==null?null:e.mechanic.username," ")}}function ii(t,n){t&1&&(a(0,"th",20),r(1," Date "),o())}function ni(t,n){if(t&1&&(a(0,"td",21),r(1),x(2,"date"),o()),t&2){let e=n.$implicit;s(),u(" ",$(2,1,e.scheduledDateTime,"short")," ")}}function ai(t,n){t&1&&(a(0,"th",20),r(1," Dur\xE9e "),o())}function oi(t,n){if(t&1&&(a(0,"td",21),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.duration," min ")}}function ri(t,n){t&1&&(a(0,"th",20),r(1," Statut "),o())}function si(t,n){if(t&1&&(a(0,"td",21)(1,"span",24),r(2),o()()),t&2){let e=n.$implicit,i=h(2);s(),m("ngClass",F(2,Ce,"bg-light-"+i.getStatusColor(e.status),"text-"+i.getStatusColor(e.status))),s(),u(" ",e.status," ")}}function li(t,n){t&1&&(a(0,"th",20),r(1," Actions "),o())}function mi(t,n){if(t&1){let e=et();a(0,"td",21)(1,"button",43),k("click",function(){let l=A(e).$implicit,f=h(2);return R(f.viewTaskDetails(l))}),a(2,"mat-icon"),r(3,"visibility"),o()()()}}function ci(t,n){t&1&&C(0,"tr",25)}function di(t,n){t&1&&C(0,"tr",26)}function pi(t,n){if(t&1&&(a(0,"table",9),d(1,38),c(2,Ye,2,0,"th",11)(3,Ze,2,1,"td",12),p(),d(4,39),c(5,ti,2,0,"th",11)(6,ei,2,1,"td",12),p(),d(7,40),c(8,ii,2,0,"th",11)(9,ni,3,4,"td",12),p(),d(10,41),c(11,ai,2,0,"th",11)(12,oi,2,1,"td",12),p(),d(13,16),c(14,ri,2,0,"th",11)(15,si,3,5,"td",12),p(),d(16,42),c(17,li,2,0,"th",11)(18,mi,4,0,"td",12),p(),c(19,ci,1,0,"tr",18)(20,di,1,0,"tr",19),o()),t&2){let e=h();m("dataSource",e.tasks),s(19),m("matHeaderRowDef",It(3,fe)),s(),m("matRowDefColumns",It(4,fe))}}function ui(t,n){t&1&&(a(0,"p"),r(1,"Aucune t\xE2che disponible."),o())}var ge=(()=>{class t{constructor(e,i,l,f,g,it,be,Me){this.taskService=e,this.appointmentService=i,this.userService=l,this.fb=f,this.route=g,this.snackBar=it,this.emailService=be,this.statusService=Me,this.displayedColumns=["client","vehicle","services","appointmentDate","status","totalEstimatedPrice"],this.services=[],this.mechanics=[],this.tasks=[],this.isFormEnable=!1,this.taskForm=this.fb.group({appointmentId:["",H.required],serviceId:["",H.required],mechanicId:["",H.required],scheduledDateTime:["",H.required],duration:["",[H.required,H.min(1)]]})}ngOnInit(){this.route.paramMap.subscribe(e=>{let i=e.get("idAppointment");i&&(this.loadAppointmentDetails(i),this.loadTasksAppointment(i),this.taskForm.patchValue({appointmentId:i}))}),this.loadMechanics()}loadAppointmentDetails(e){this.appointmentService.getAppointmentById(e).subscribe({next:i=>{this.appointment=i,this.services=i.services,this.isFormEnable=this.appointment?.status==="En attente"||this.appointment?.status==="Confirm\xE9"},error:()=>{}})}loadMechanics(){this.userService.getMechanics().subscribe(e=>{this.mechanics=e})}createTask(){if(this.taskForm.valid){let e=this.taskForm.value;this.taskService.createTask(e).subscribe({next:i=>{console.log("T\xE2che cr\xE9\xE9e avec succ\xE8s:",i),this.snackBar.open(i.message,"Fermer",{duration:3e3})},error:i=>{this.snackBar.open(i.message,"Fermer",{duration:3e3}),console.error("Erreur lors de la cr\xE9ation de la t\xE2che",i)}})}}cancel(){this.taskForm.reset()}getStatusColor(e){return this.statusService.getStatusColor(e)}onServiceChange(e){let i=this.services.find(l=>l._id===e);i&&this.taskForm.get("duration")?.setValue(i.estimatedDuration)}loadTasksAppointment(e){this.taskService.getTasksForAppointment(e).subscribe({next:i=>{this.tasks=i.tasks},error:i=>{console.error("Erreur lors de la r\xE9cup\xE9ration des t\xE2ches:",i)}})}viewTaskDetails(e){console.log("D\xE9tails de la t\xE2che :",e)}static{this.\u0275fac=function(i){return new(i||t)(_(w),_(ue),_(ce),_(Zt),_(rt),_(le),_(de),_(Z))}}static{this.\u0275cmp=T({type:t,selectors:[["app-add"]],decls:16,vars:4,consts:[["noTasks",""],[1,"cardWithShadow","theme-card"],[1,"m-b-0"],[1,"b-t-1"],[1,"row"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"task-container"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf","ngIfElse"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","client"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","vehicle"],["matColumnDef","services"],["matColumnDef","appointmentDate"],["matColumnDef","status"],["matColumnDef","totalEstimatedPrice"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"f-s-12","f-w-500","p-x-10","p-y-4","rounded-pill",3,"ngClass"],["mat-header-row",""],["mat-row",""],[3,"ngSubmit","formGroup"],["appearance","fill"],["formControlName","serviceId","required","",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","duration","type","number","required",""],["matInput","","formControlName","scheduledDateTime","type","datetime-local","required",""],["formControlName","mechanicId","required",""],[1,"actions"],["mat-button","","type","submit",3,"disabled"],["mat-button","",3,"click"],[3,"value"],["matColumnDef","service"],["matColumnDef","mechanic"],["matColumnDef","date"],["matColumnDef","duration"],["matColumnDef","actions"],["mat-icon-button","","color","primary",3,"click"]],template:function(i,l){if(i&1&&(a(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title",2),r(3,"Ajouter une t\xE2che pour l'appointment"),o()(),a(4,"mat-card-content",3)(5,"div",4)(6,"h3"),r(7,"Informations sur l'Appointment"),o(),c(8,Je,21,5,"table",5),o(),c(9,Xe,21,4,"form",6),a(10,"div",7)(11,"h2"),r(12,"Liste des T\xE2ches"),o(),c(13,pi,21,5,"table",8)(14,ui,2,0,"ng-template",null,0,L),o()()()),i&2){let f=S(15);s(8),m("ngIf",l.appointment),s(),m("ngIf",l.isFormEnable),s(4),m("ngIf",l.tasks.length>0)("ngIfElse",f)}},dependencies:[v,b,Nt,V,j,dt,Jt,mt,Kt,ct,Gt,Yt,pt,Qt,Xt,pe,I,qt,ft,ut,ht,ne,M,y,Tt,E,P,O,D,N,W,J,q,U,K,G,z,Q,X],styles:[".appointment-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;padding:10px;border:1px solid #ddd;border-radius:8px;background:#f9f9f9}.appointment-item[_ngcontent-%COMP%]{flex:1;min-width:150px}.status-badge[_ngcontent-%COMP%]{padding:5px 10px;border-radius:12px;font-weight:700}.bg-light-success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.bg-light-warning[_ngcontent-%COMP%]{background-color:#fff3cd;color:#856404}.bg-light-danger[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}"]})}}return t})();var hi=(t,n)=>[t,n],Ci=t=>["/tasks/editReason",t];function gi(t,n){t&1&&(a(0,"th",18),r(1," Service "),o())}function Ti(t,n){if(t&1&&(a(0,"td",19),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.service==null?null:e.service.name," ")}}function ki(t,n){t&1&&(a(0,"th",18),r(1," M\xE9canicien "),o())}function vi(t,n){if(t&1&&(a(0,"td",19),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.mechanic==null?null:e.mechanic.username," ")}}function Si(t,n){t&1&&(a(0,"th",18),r(1," Date "),o())}function xi(t,n){if(t&1&&(a(0,"td",19),r(1),x(2,"date"),o()),t&2){let e=n.$implicit;s(),u(" ",$(2,1,e.scheduledDateTime,"short")," ")}}function bi(t,n){t&1&&(a(0,"th",18),r(1," Dur\xE9e "),o())}function Mi(t,n){if(t&1&&(a(0,"td",19),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.duration," min ")}}function Ei(t,n){t&1&&(a(0,"th",18),r(1," Statut "),o())}function yi(t,n){if(t&1&&(a(0,"td",19)(1,"span",20),r(2),o()()),t&2){let e=n.$implicit,i=h(2);s(),m("ngClass",F(2,hi,"bg-light-"+i.getStatusColor(e.status),"text-"+i.getStatusColor(e.status))),s(),u(" ",e.status," ")}}function Di(t,n){t&1&&C(0,"th",21)}function Ii(t,n){if(t&1&&(a(0,"td",19)(1,"button",22)(2,"mat-icon"),r(3,"more_vert"),o()(),a(4,"mat-menu",23,1)(6,"a",24),C(7,"i-tabler",25),a(8,"span"),r(9,"Modifier"),o()()()()),t&2){let e=n.$implicit,i=S(5);s(),m("matMenuTriggerFor",i),s(5),m("routerLink",B(2,Ci,e._id))}}function wi(t,n){t&1&&C(0,"tr",26)}function Ai(t,n){t&1&&C(0,"tr",27)}function Ri(t,n){if(t&1&&(a(0,"table",6),d(1,7),c(2,gi,2,0,"th",8)(3,Ti,2,1,"td",9),p(),d(4,10),c(5,ki,2,0,"th",8)(6,vi,2,1,"td",9),p(),d(7,11),c(8,Si,2,0,"th",8)(9,xi,3,4,"td",9),p(),d(10,12),c(11,bi,2,0,"th",8)(12,Mi,2,1,"td",9),p(),d(13,13),c(14,Ei,2,0,"th",8)(15,yi,3,5,"td",9),p(),d(16,14),c(17,Di,1,0,"th",15)(18,Ii,10,4,"td",9),p(),c(19,wi,1,0,"tr",16)(20,Ai,1,0,"tr",17),o()),t&2){let e=h();m("dataSource",e.tasks),s(19),m("matHeaderRowDef",e.displayedColumns),s(),m("matRowDefColumns",e.displayedColumns)}}function Fi(t,n){t&1&&(a(0,"p"),r(1,"Aucune t\xE2che disponible."),o())}var Te=(()=>{class t{constructor(e,i){this.taskService=e,this.statusService=i,this.tasks=[],this.displayedColumns=["service","mechanic","date","duration","status","menu"]}ngOnInit(){this.loadTasks()}loadTasks(){this.taskService.getAllTasks().subscribe({next:e=>{this.tasks=e},error:e=>{console.error("Erreur lors de la r\xE9cup\xE9ration des t\xE2ches",e)}})}viewTaskDetails(e){console.log("D\xE9tails de la t\xE2che :",e)}getStatusColor(e){return this.statusService.getStatusColor(e)}static{this.\u0275fac=function(i){return new(i||t)(_(w),_(Z))}}static{this.\u0275cmp=T({type:t,selectors:[["app-task-list"]],decls:8,vars:2,consts:[["noTasks",""],["menu","matMenu"],[1,"cardWithShadow","overflow-hidden"],[1,"m-b-4"],[1,"table-responsive"],["mat-table","","class","w-100",3,"dataSource",4,"ngIf","ngIfElse"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","service"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","mechanic"],["matColumnDef","date"],["matColumnDef","duration"],["matColumnDef","status"],["matColumnDef","menu"],["mat-header-cell","","class","mat-subtitle-1 f-s-14",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"f-s-12","f-w-500","p-x-10","p-y-4","rounded-pill",3,"ngClass"],["mat-header-cell","",1,"mat-subtitle-1","f-s-14"],["mat-icon-button","","color","primary",3,"matMenuTriggerFor"],["xPosition","before"],[1,"d-flex","align-items-center","text-decoration-none","p-y-10","p-x-16","mat-body-1","gap-8",3,"routerLink"],["name","edit",1,"icon-18"],["mat-header-row",""],["mat-row",""]],template:function(i,l){if(i&1&&(a(0,"mat-card",2)(1,"mat-card-content")(2,"mat-card-title",3),r(3,"Liste des T\xE2ches"),o()(),a(4,"div",4),c(5,Ri,21,3,"table",5)(6,Fi,2,0,"ng-template",null,0,L),o()()),i&2){let f=S(7);s(5),m("ngIf",l.tasks.length>0)("ngIfElse",f)}},dependencies:[v,b,V,j,I,Ct,gt,M,y,E,O,D,N,W,J,q,U,K,G,z,Q,X,lt,st,St,vt],encapsulation:2})}}return t})();var ke=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=T({type:t,selectors:[["app-edit"]],decls:2,vars:0,template:function(i,l){i&1&&(a(0,"p"),r(1,"edit works!"),o())},encapsulation:2})}}return t})();var $i=(t,n)=>[t,n],Hi=t=>["/tasks/editReason",t];function Bi(t,n){t&1&&(a(0,"th",18),r(1," Service "),o())}function Li(t,n){if(t&1&&(a(0,"td",19),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.service==null?null:e.service.name," ")}}function Vi(t,n){t&1&&(a(0,"th",18),r(1," M\xE9canicien "),o())}function ji(t,n){if(t&1&&(a(0,"td",19),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.mechanic==null?null:e.mechanic.username," ")}}function Pi(t,n){t&1&&(a(0,"th",18),r(1," Date "),o())}function Oi(t,n){if(t&1&&(a(0,"td",19),r(1),x(2,"date"),o()),t&2){let e=n.$implicit;s(),u(" ",$(2,1,e.scheduledDateTime,"short")," ")}}function Ni(t,n){t&1&&(a(0,"th",18),r(1," Dur\xE9e "),o())}function Ui(t,n){if(t&1&&(a(0,"td",19),r(1),o()),t&2){let e=n.$implicit;s(),u(" ",e.duration," min ")}}function Wi(t,n){t&1&&(a(0,"th",18),r(1," Statut "),o())}function qi(t,n){if(t&1&&(a(0,"td",19)(1,"span",20),r(2),o()()),t&2){let e=n.$implicit,i=h(2);s(),m("ngClass",F(2,$i,"bg-light-"+i.getStatusColor(e.status),"text-"+i.getStatusColor(e.status))),s(),u(" ",e.status," ")}}function Gi(t,n){t&1&&C(0,"th",21)}function zi(t,n){if(t&1&&(a(0,"td",19)(1,"button",22)(2,"mat-icon"),r(3,"more_vert"),o()(),a(4,"mat-menu",23,1)(6,"a",24),C(7,"i-tabler",25),a(8,"span"),r(9,"Modifier"),o()()()()),t&2){let e=n.$implicit,i=S(5);s(),m("matMenuTriggerFor",i),s(5),m("routerLink",B(2,Hi,e._id))}}function Ji(t,n){t&1&&C(0,"tr",26)}function Ki(t,n){t&1&&C(0,"tr",27)}function Qi(t,n){if(t&1&&(a(0,"table",6),d(1,7),c(2,Bi,2,0,"th",8)(3,Li,2,1,"td",9),p(),d(4,10),c(5,Vi,2,0,"th",8)(6,ji,2,1,"td",9),p(),d(7,11),c(8,Pi,2,0,"th",8)(9,Oi,3,4,"td",9),p(),d(10,12),c(11,Ni,2,0,"th",8)(12,Ui,2,1,"td",9),p(),d(13,13),c(14,Wi,2,0,"th",8)(15,qi,3,5,"td",9),p(),d(16,14),c(17,Gi,1,0,"th",15)(18,zi,10,4,"td",9),p(),c(19,Ji,1,0,"tr",16)(20,Ki,1,0,"tr",17),o()),t&2){let e=h();m("dataSource",e.tasks),s(19),m("matHeaderRowDef",e.displayedColumns),s(),m("matRowDefColumns",e.displayedColumns)}}function Xi(t,n){t&1&&(a(0,"p"),r(1,"Aucune t\xE2che disponible."),o())}var ve=(()=>{class t{constructor(e,i,l){this.taskService=e,this.authService=i,this.statusService=l,this.tasks=[],this.mechanicId="",this.displayedColumns=["service","mechanic","date","duration","status","menu"]}ngOnInit(){this.loadTasks()}loadTasks(){let e=this.authService.currentUserValue.user_id;this.taskService.getTasksByMechanic(e?.toString()).subscribe({next:i=>{this.tasks=i},error:i=>{console.error("Erreur lors de la r\xE9cup\xE9ration des t\xE2ches",i)}})}viewTaskDetails(e){console.log("D\xE9tails de la t\xE2che :",e)}getStatusColor(e){return this.statusService.getStatusColor(e)}static{this.\u0275fac=function(i){return new(i||t)(_(w),_(xt),_(Z))}}static{this.\u0275cmp=T({type:t,selectors:[["app-me"]],decls:8,vars:2,consts:[["noTasks",""],["menu","matMenu"],[1,"cardWithShadow","overflow-hidden"],[1,"m-b-4"],[1,"table-responsive"],["mat-table","","class","w-100",3,"dataSource",4,"ngIf","ngIfElse"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","service"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","mechanic"],["matColumnDef","date"],["matColumnDef","duration"],["matColumnDef","status"],["matColumnDef","menu"],["mat-header-cell","","class","mat-subtitle-1 f-s-14",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"f-s-12","f-w-500","p-x-10","p-y-4","rounded-pill",3,"ngClass"],["mat-header-cell","",1,"mat-subtitle-1","f-s-14"],["mat-icon-button","","color","primary",3,"matMenuTriggerFor"],["xPosition","before"],[1,"d-flex","align-items-center","text-decoration-none","p-y-10","p-x-16","mat-body-1","gap-8",3,"routerLink"],["name","edit",1,"icon-18"],["mat-header-row",""],["mat-row",""]],template:function(i,l){if(i&1&&(a(0,"mat-card",2)(1,"mat-card-content")(2,"mat-card-title",3),r(3,"Liste des T\xE2ches"),o()(),a(4,"div",4),c(5,Qi,21,3,"table",5)(6,Xi,2,0,"ng-template",null,0,L),o()()),i&2){let f=S(7);s(5),m("ngIf",l.tasks.length>0)("ngIfElse",f)}},dependencies:[v,b,V,j,I,Ct,gt,M,y,E,O,D,N,W,J,q,U,K,G,z,Q,X,lt,st,St,vt],encapsulation:2})}}return t})();var Se=(()=>{class t{constructor(e){this.location=e}goBack(){this.location.back()}static{this.\u0275fac=function(i){return new(i||t)(_(Ot))}}static{this.\u0275cmp=T({type:t,selectors:[["app-back-button"]],decls:3,vars:0,consts:[["mat-flat-button","",1,"m-r-8",3,"click"],[1,"m-r-4"]],template:function(i,l){i&1&&(a(0,"button",0),k("click",function(){return l.goBack()}),a(1,"mat-icon",1),r(2,"arrow_back"),o()())},dependencies:[v,_t,P,kt,D],encapsulation:2})}}return t})();var Yi=(t,n)=>n.color;function Zi(t,n){if(t&1){let e=et();a(0,"mat-chip-option",15),k("click",function(){let l=A(e).$implicit,f=h();return R(f.selectedReason=l.name)}),r(1),o()}if(t&2){let e=n.$implicit,i=h();m("color",e.color)("selected",i.selectedReason===e.name)("ngClass",i.getReasonClasses(e.name)),s(),u(" ",e.name," ")}}var xe=(()=>{class t{constructor(e,i,l){this.taskService=e,this.route=i,this.cdr=l,this.availableColors=[{name:"Primary",color:"primary"},{name:"Accent",color:"accent"},{name:"Warn",color:"warn"}],this.selectedReason="En cours",this.message="",this.currentDateTime=new Date().toISOString().slice(0,16),this.sendMail=!1}ngOnInit(){this.taskId=this.route.snapshot.paramMap.get("id")||"",this.loadReasons(),this.taskId&&this.taskService.getTaskById(this.taskId).subscribe({next:e=>{this.task=e,this.updateSelectedReason()},error:e=>{console.error("Erreur lors de la r\xE9cup\xE9ration de la t\xE2che",e)}})}loadReasons(){this.reasons=[{name:"Travail en cours",value:"En cours",color:"primary"},{name:"Termin\xE9",value:"Termin\xE9",color:"accent"},{name:"Annuler",value:"Annul\xE9",color:"danger"},{name:"En attente",value:"En attente",color:"warn"}],this.updateSelectedReason()}updateSelectedReason(){if(this.task&&this.task.status&&this.reasons.length>0){let e=this.reasons.find(i=>i.value===this.task.status);this.selectedReason=e?e.name:"",this.cdr.detectChanges()}}validate(){console.log("Message :",this.message),console.log("Date et heure :",this.currentDateTime),console.log("Envoyer mail :",this.sendMail)}onReasonChange(e){this.selectedReason=e,console.log("Raison s\xE9lectionn\xE9e:",e)}getReasonClasses(e){let i=this.reasons.find(l=>l.name===e);return i&&this.selectedReason===e?i.color:""}getReasonValue(e){let i=this.reasons.find(l=>l.name===e);return i?i.value:""}updateStatus(){let e=this.getReasonValue(this.selectedReason);this.taskService.updateTaskStatus(this.taskId,e,this.message).subscribe({next:i=>{console.log("Mise \xE0 jour r\xE9ussie",i)},error:i=>{console.error("Erreur lors de la mise \xE0 jour",i)}})}setDefaultSelectedReason(){if(this.task&&this.task.status&&this.reasons.length>0){let e=this.reasons.find(i=>i.value===this.task.status);e&&(this.selectedReason=e.name)}}static{this.\u0275fac=function(i){return new(i||t)(_(w),_(rt),_(Pt))}}static{this.\u0275cmp=T({type:t,selectors:[["app-edit-reason"]],decls:38,vars:5,consts:[[1,"cardWithShadow","theme-card"],[1,"m-b-0"],[1,"b-t-1"],[1,"row"],[1,"col-lg-6"],[1,"b-1","shadow-none"],["aria-label","Color selection",1,"mat-mdc-chip-set-stacked"],[3,"color","selected","ngClass"],["appearance","outline",1,"full-width"],["matInput","",3,"ngModelChange","ngModel"],["matInput","","type","datetime-local",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[3,"value"],[1,"button-container"],["mat-raised-button","","color","primary",3,"click"],[3,"click","color","selected","ngClass"]],template:function(i,l){i&1&&(a(0,"mat-card",0),C(1,"app-back-button"),a(2,"mat-card-header")(3,"mat-card-title",1),r(4,"Modifier le Status de la T\xE2che"),o()(),a(5,"mat-card-content",2)(6,"div",3)(7,"div",4)(8,"mat-card",5)(9,"mat-card-header")(10,"mat-card-title"),r(11,"Raisons"),o()(),a(12,"mat-card-content",2)(13,"mat-chip-listbox",6),Bt(14,Zi,2,4,"mat-chip-option",7,Yi),o()()()(),a(16,"div",4)(17,"mat-card",5)(18,"mat-card-header")(19,"mat-card-title"),r(20,"Messages"),o()(),a(21,"mat-card-content",2)(22,"mat-form-field",8)(23,"mat-label"),r(24,"Message"),o(),a(25,"textarea",9),ot("ngModelChange",function(g){return at(l.message,g)||(l.message=g),g}),o()(),a(26,"mat-form-field",8)(27,"mat-label"),r(28,"Date et heure"),o(),a(29,"input",10),ot("ngModelChange",function(g){return at(l.currentDateTime,g)||(l.currentDateTime=g),g}),o()(),a(30,"mat-radio-group",11),ot("ngModelChange",function(g){return at(l.sendMail,g)||(l.sendMail=g),g}),a(31,"mat-radio-button",12),r(32,"Envoyer mail"),o(),a(33,"mat-radio-button",12),r(34,"Ne pas envoyer"),o()(),a(35,"div",13)(36,"button",14),k("click",function(){return l.updateStatus()}),r(37,"Valider"),o()()()()()()()()),i&2&&(s(14),Lt(l.reasons),s(11),nt("ngModel",l.message),s(4),nt("ngModel",l.currentDateTime),s(),nt("ngModel",l.sendMail),s(),m("value",!0),s(2),m("value",!1))},dependencies:[te,ft,ut,se,re,oe,kt,ae,M,y,Tt,E,dt,mt,ct,zt,pt,_t,P,v,b,I,ht,ee,ie,Se],styles:[".danger[_ngcontent-%COMP%]{background-color:#ffabab!important;color:#fff}.primary[_ngcontent-%COMP%]{background-color:#a9a9ff!important;color:#fff}.accent[_ngcontent-%COMP%]{background-color:#a8ffa8!important;color:#fff}.warn[_ngcontent-%COMP%]{background-color:#ffc400!important;color:#fff}"],changeDetection:0})}}return t})();var Qn=[{path:"",children:[{path:"add/:idAppointment",canActivate:[Y],data:{roles:["manager"]},component:ge},{path:"all",canActivate:[Y],data:{roles:["manager"]},component:Te},{path:"me",canActivate:[Y],data:{roles:["mecanicien"]},component:ve},{path:"edit/:id",canActivate:[Y],data:{roles:["manager"]},component:ke},{path:"editReason/:id",canActivate:[Y],data:{roles:["manager","mecanicien"]},component:xe}]}];export{Qn as TaskRoutes};
